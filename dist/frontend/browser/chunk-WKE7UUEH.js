import{b as E,c as m,d as R,e as M,g as L,i as N,j as T,q as V,r as O,t as A}from"./chunk-RGSRR5HZ.js";import{a as _}from"./chunk-QUIS4U7J.js";import{b as j,c as k}from"./chunk-QZVPFBDY.js";import"./chunk-WMIV6HCU.js";import{b as S,h as P,n as y,p as F,v as x}from"./chunk-UO6RE5ZL.js";import{$a as p,Aa as i,Bb as d,Cb as C,Ja as c,Kb as b,Oa as h,ab as u,eb as n,fb as a,gb as s,hb as l,pb as v,rb as g,zb as w}from"./chunk-536N3UDQ.js";var G=(o,t)=>({"text-green-600":o,"text-red-600":t});function I(o,t){o&1&&(a(0,"span"),d(1,"V\xE9rifier"),s())}function q(o,t){o&1&&l(0,"span",11)}function z(o,t){if(o&1&&(a(0,"div",12),d(1),s()),o&2){let r=g();n("ngClass",b(2,G,r.otpStatus==="valid",r.otpStatus==="invalid"||r.otpStatus==="expired")),i(),C(r.otpMessage)}}function B(o,t){o&1&&(a(0,"div",18),d(1," Les mots de passe ne correspondent pas "),s())}function W(o,t){o&1&&(a(0,"span"),d(1,"R\xE9initialiser le mot de passe"),s())}function $(o,t){o&1&&l(0,"span",11)}var D=class o{constructor(t,r,e,f,H){this.fb=t;this.route=r;this.authService=e;this.notification=f;this.router=H;this.email=this.route.snapshot.queryParamMap.get("email")||"",this.resetForm=this.fb.group({email:[this.email,[m.required,m.email]],otpCode:["",[m.required,m.pattern("^[0-9]{6}$")]],newPassword:[{value:"",disabled:!0},[m.required,m.minLength(8)]],confirmPassword:[{value:"",disabled:!0},[m.required]]},{validators:this.passwordsMatchValidator})}resetForm;isLoading=!1;submitted=!1;email="";otpStatus="pending";otpMessage="";updatePasswordFieldsState(){this.otpStatus==="valid"?(this.newPassword?.enable(),this.confirmPassword?.enable()):(this.newPassword?.disable(),this.confirmPassword?.disable())}get emailControl(){return this.resetForm.get("email")}get otpCode(){return this.resetForm.get("otpCode")}get newPassword(){return this.resetForm.get("newPassword")}get confirmPassword(){return this.resetForm.get("confirmPassword")}passwordsMatchValidator(t){let r=t.get("newPassword")?.value,e=t.get("confirmPassword")?.value;return r===e?null:{passwordMismatch:!0}}onVerifyOtp(){let{email:t,otpCode:r}=this.resetForm.value;if(!t||!r||this.otpCode?.invalid){this.otpStatus="invalid",this.otpMessage="Veuillez saisir un code valide.";return}this.isLoading=!0,this.authService.verifyOtp(t,r).subscribe({next:e=>{e.valid?(this.otpStatus="valid",this.otpMessage="Code OTP valide.",this.updatePasswordFieldsState()):e.expired?(this.otpStatus="expired",this.otpMessage="Code OTP expir\xE9.",this.updatePasswordFieldsState()):(this.otpStatus="invalid",this.otpMessage=e.message||"Code OTP invalide.",this.updatePasswordFieldsState()),this.isLoading=!1},error:e=>{this.otpStatus="invalid",this.otpMessage=e?.message||"Erreur lors de la v\xE9rification.",this.updatePasswordFieldsState(),this.isLoading=!1}})}onSubmit(){if(this.submitted=!0,this.resetForm.invalid||this.otpStatus!=="valid"){this.notification.error(this.otpStatus==="valid"?"Formulaire invalide.":this.otpMessage||"Veuillez v\xE9rifier le code OTP.");return}this.isLoading=!0;let{email:t,otpCode:r,newPassword:e}=this.resetForm.value;this.authService.resetPasswordWithOtp(t,r,e).subscribe({next:()=>{this.notification.success("Votre mot de passe a \xE9t\xE9 r\xE9initialis\xE9 avec succ\xE8s."),this.isLoading=!1,this.router.navigate(["/auth/login"])},error:f=>{this.notification.error(f?.message||"Erreur lors de la r\xE9initialisation."),this.isLoading=!1}})}static \u0275fac=function(r){return new(r||o)(c(O),c(y),c(_),c(x),c(F))};static \u0275cmp=h({type:o,selectors:[["app-reset-password"]],decls:33,vars:17,consts:[["title","R\xE9initialisation du mot de passe","subtitle","Saisissez le code re\xE7u par email"],[1,"space-y-6",3,"ngSubmit","formGroup"],[1,"border-b","pb-4","mb-4"],[1,"mb-2","text-base","font-semibold","text-primary-700"],["for","email",1,"block","text-sm","font-medium","mb-2"],["id","email","type","email","formControlName","email",1,"w-full","px-4","py-2","border","rounded-lg",3,"readonly"],[3,"control"],["for","otpCode",1,"block","text-sm","font-medium","mt-4","mb-2"],[1,"flex","gap-2"],["id","otpCode","type","text","maxlength","6","formControlName","otpCode",1,"w-full","px-4","py-2","border","rounded-lg",3,"readonly"],["type","button",1,"px-4","py-2","bg-primary-500","text-white","rounded-lg","flex","items-center","justify-center","cursor-pointer","disabled:cursor-not-allowed",3,"click","disabled"],[1,"loader","ml-2"],[1,"text-sm","mt-1","font-semibold",3,"ngClass"],[1,"opacity-100","transition-opacity","duration-300"],["for","newPassword",1,"block","text-sm","font-medium","mb-2"],["id","newPassword","type","password","formControlName","newPassword",1,"w-full","px-4","py-2","border","rounded-lg"],["for","confirmPassword",1,"block","text-sm","font-medium","mb-2","mt-4"],["id","confirmPassword","type","password","formControlName","confirmPassword",1,"w-full","px-4","py-2","border","rounded-lg"],[1,"text-sm","text-red-600"],["type","submit",1,"w-full","py-2","bg-primary-600","text-white","rounded-lg","flex","items-center","justify-center","mt-4","cursor-pointer","disabled:cursor-not-allowed",3,"disabled"]],template:function(r,e){r&1&&(a(0,"app-auth-card",0)(1,"form",1),v("ngSubmit",function(){return e.onSubmit()}),a(2,"div",2)(3,"div",3),d(4,"1. V\xE9rifiez le code OTP"),s(),a(5,"label",4),d(6,"Email"),s(),l(7,"input",5)(8,"app-form-field-error",6),a(9,"label",7),d(10,"Code re\xE7u par email"),s(),a(11,"div",8),l(12,"input",9),a(13,"button",10),v("click",function(){return e.onVerifyOtp()}),p(14,I,2,0,"span"),p(15,q,1,0,"span",11),s()(),l(16,"app-form-field-error",6),p(17,z,2,5,"div",12),s(),a(18,"div",13)(19,"div",3),d(20,"2. Saisissez le nouveau mot de passe"),s(),a(21,"label",14),d(22,"Nouveau mot de passe"),s(),l(23,"input",15)(24,"app-form-field-error",6),a(25,"label",16),d(26,"Confirmer le mot de passe"),s(),l(27,"input",17)(28,"app-form-field-error",6),p(29,B,2,0,"div",18),s(),a(30,"button",19),p(31,W,2,0,"span"),p(32,$,1,0,"span",11),s()()()),r&2&&(i(),n("formGroup",e.resetForm),i(6),n("readonly",!0),i(),n("control",e.emailControl),i(4),n("readonly",e.otpStatus==="valid"),i(),n("disabled",(e.otpCode==null?null:e.otpCode.invalid)||e.isLoading||e.otpStatus==="valid"),i(),u(e.isLoading?-1:14),i(),u(e.isLoading?15:-1),i(),n("control",e.otpCode),i(),u(e.otpStatus!=="pending"?17:-1),i(),w("opacity-50",e.otpStatus!=="valid"),i(6),n("control",e.newPassword),i(4),n("control",e.confirmPassword),i(),u(e.resetForm.hasError("passwordMismatch")&&(e.confirmPassword!=null&&e.confirmPassword.touched)?29:-1),i(),n("disabled",e.resetForm.invalid||e.isLoading||e.otpStatus!=="valid"),i(),u(e.isLoading?-1:31),i(),u(e.isLoading?32:-1))},dependencies:[P,S,A,L,E,R,M,V,T,N,k,j],encapsulation:2,changeDetection:0})};export{D as ResetPasswordComponent};
