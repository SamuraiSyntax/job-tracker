import{k as c,p as h,u as p}from"./chunk-CJVXGS2H.js";import{A as o,N as s,S as a,Sb as u,ga as i,o as g}from"./chunk-7SIT5ZTB.js";var n=class t{getItem(e){try{return localStorage.getItem(e)}catch(r){return console.error(`Erreur lors de la lecture de localStorage[${e}]:`,r),null}}getItemParsed(e){try{let r=localStorage.getItem(e);return r?JSON.parse(r):null}catch(r){return console.error(`Erreur lors du parsing de localStorage[${e}]:`,r),null}}setItem(e,r){try{return localStorage.setItem(e,r),!0}catch(l){return console.error(`Erreur lors de l'\xE9criture dans localStorage[${e}]:`,l),!1}}setItemStringified(e,r){try{return localStorage.setItem(e,JSON.stringify(r)),!0}catch(l){return console.error(`Erreur lors de la s\xE9rialisation dans localStorage[${e}]:`,l),!1}}removeItem(e){try{return localStorage.removeItem(e),!0}catch(r){return console.error(`Erreur lors de la suppression de localStorage[${e}]:`,r),!1}}clear(){try{return localStorage.clear(),!0}catch(e){return console.error("Erreur lors du nettoyage de localStorage:",e),!1}}hasItem(e){try{return localStorage.getItem(e)!==null}catch(r){return console.error(`Erreur lors de la v\xE9rification de localStorage[${e}]:`,r),!1}}keys(){try{return Object.keys(localStorage)}catch(e){return console.error("Erreur lors de la r\xE9cup\xE9ration des cl\xE9s de localStorage:",e),[]}}length(){try{return localStorage.length}catch(e){return console.error("Erreur lors du comptage des \xE9l\xE9ments de localStorage:",e),0}}static \u0275fac=function(r){return new(r||t)};static \u0275prov=s({token:t,factory:t.\u0275fac,providedIn:"root"})};var m=class t{API_URL=`${p.apiUrl}/auth`;TOKEN_KEY="auth_token";USER_KEY="current_user";http=a(c);router=a(h);storage=a(n);currentUserSignal=i(this.loadUserFromStorage());tokenSignal=i(this.loadTokenFromStorage());isAuthenticated=u(()=>!!this.tokenSignal());getCurrentUser=u(()=>this.currentUserSignal());login(e){return this.http.post(`${this.API_URL}/login`,e).pipe(o(this.handleError))}register(e){return this.http.post(`${this.API_URL}/register`,e).pipe(o(this.handleError))}logout(){this.storage.removeItem(this.TOKEN_KEY),this.storage.removeItem(this.USER_KEY),this.tokenSignal.set(null),this.currentUserSignal.set(null),this.router.navigate(["/auth/login"])}getToken(){return this.tokenSignal()}forgotPassword(e){return this.http.post(`${this.API_URL}/forgot-password`,{email:e}).pipe(o(this.handleError))}resetPassword(e,r){return this.http.post(`${this.API_URL}/reset-password`,{token:e,newPassword:r}).pipe(o(this.handleError))}handleAuthentication(e){this.storage.setItem(this.TOKEN_KEY,e.token),this.storage.setItemStringified(this.USER_KEY,e.user),this.tokenSignal.set(e.token),this.currentUserSignal.set(e.user)}loadUserFromStorage(){return this.storage.getItemParsed(this.USER_KEY)}loadTokenFromStorage(){return this.storage.getItem(this.TOKEN_KEY)}handleError(e){let r="Une erreur est survenue";return e.error instanceof ErrorEvent?r=`Erreur: ${e.error.message}`:e.status===400||e.status===401?r=e.error?.message||"Email ou mot de passe incorrect":e.status===409?r=e.error?.message||"L'email est d\xE9j\xE0 utilis\xE9":e.status===0&&(r="Impossible de contacter le serveur"),g(()=>({message:r}))}static \u0275fac=function(r){return new(r||t)};static \u0275prov=s({token:t,factory:t.\u0275fac,providedIn:"root"})};export{m as a};
