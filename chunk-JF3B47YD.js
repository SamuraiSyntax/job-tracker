import{E as c,Na as h,ab as p,fb as n,j as d,kb as m,n as s,r as g,u as i,y as a}from"./chunk-6FHC7S6G.js";var l=class t{router=a(n);routes={auth:{login:"/auth/login",register:"/auth/register"},dashboard:"/dashboard",profile:"/profile",settings:"/settings",stats:"/stats",candidatures:{list:"/candidatures",new:"/candidatures/new",detail:e=>`/candidatures/${e}`,edit:e=>`/candidatures/${e}/edit`}};toLogin(){return this.router.navigate([this.routes.auth.login])}toRegister(){return this.router.navigate([this.routes.auth.register])}toDashboard(){return this.router.navigate([this.routes.dashboard])}toProfile(){return this.router.navigate([this.routes.profile])}toSettings(){return this.router.navigate([this.routes.settings])}toStats(){return this.router.navigate([this.routes.stats])}toCandidaturesList(){return this.router.navigate([this.routes.candidatures.list])}toNewCandidature(){return this.router.navigate([this.routes.candidatures.new])}toCandidatureDetail(e){return this.router.navigate([this.routes.candidatures.detail(e)])}toEditCandidature(e){return this.router.navigate([this.routes.candidatures.edit(e)])}navigateWithParams(e,r){return this.router.navigate(e,{queryParams:r})}back(){window.history.back()}static \u0275fac=function(r){return new(r||t)};static \u0275prov=i({token:t,factory:t.\u0275fac,providedIn:"root"})};var u=class t{getItem(e){try{return localStorage.getItem(e)}catch(r){return console.error(`Erreur lors de la lecture de localStorage[${e}]:`,r),null}}getItemParsed(e){try{let r=localStorage.getItem(e);return r?JSON.parse(r):null}catch(r){return console.error(`Erreur lors du parsing de localStorage[${e}]:`,r),null}}setItem(e,r){try{return localStorage.setItem(e,r),!0}catch(o){return console.error(`Erreur lors de l'\xE9criture dans localStorage[${e}]:`,o),!1}}setItemStringified(e,r){try{return localStorage.setItem(e,JSON.stringify(r)),!0}catch(o){return console.error(`Erreur lors de la s\xE9rialisation dans localStorage[${e}]:`,o),!1}}removeItem(e){try{return localStorage.removeItem(e),!0}catch(r){return console.error(`Erreur lors de la suppression de localStorage[${e}]:`,r),!1}}clear(){try{return localStorage.clear(),!0}catch(e){return console.error("Erreur lors du nettoyage de localStorage:",e),!1}}hasItem(e){try{return localStorage.getItem(e)!==null}catch(r){return console.error(`Erreur lors de la v\xE9rification de localStorage[${e}]:`,r),!1}}keys(){try{return Object.keys(localStorage)}catch(e){return console.error("Erreur lors de la r\xE9cup\xE9ration des cl\xE9s de localStorage:",e),[]}}length(){try{return localStorage.length}catch(e){return console.error("Erreur lors du comptage des \xE9l\xE9ments de localStorage:",e),0}}static \u0275fac=function(r){return new(r||t)};static \u0275prov=i({token:t,factory:t.\u0275fac,providedIn:"root"})};var b=class t{API_URL=`${m.apiUrl}/auth`;TOKEN_KEY="auth_token";USER_KEY="current_user";http=a(p);router=a(n);storage=a(u);navigationService=a(l);currentUserSignal=c(null);tokenSignal=c(null);isAuthenticated=h(()=>{let e=this.tokenSignal();return!!e&&!this.isTokenExpired(e)});getCurrentUser=h(()=>this.currentUserSignal());constructor(){let e=this.loadTokenFromStorage();if(e&&!this.isTokenExpired(e)){this.tokenSignal.set(e);let r=this.loadUserFromStorage();this.currentUserSignal.set(r)}else this.clearAuth()}login(e){return this.http.post(`${this.API_URL}/login`,e).pipe(g(r=>this.handleAuthentication(r)),s(this.handleError))}register(e){return this.http.post(`${this.API_URL}/register`,e).pipe(g(r=>this.handleAuthentication(r)),s(this.handleError))}logout(){this.clearAuth(),this.navigationService.toLogin()}clearAuth(){this.storage.removeItem(this.TOKEN_KEY),this.storage.removeItem(this.USER_KEY),this.tokenSignal.set(null),this.currentUserSignal.set(null)}getToken(){let e=this.tokenSignal();return!e||this.isTokenExpired(e)?(this.clearAuth(),null):e}isTokenExpired(e){try{let r=JSON.parse(atob(e.split(".")[1]));if(!r.exp)return!0;let o=Math.floor(Date.now()/1e3);return r.exp<o}catch{return!0}}forgotPassword(e){return this.http.post(`${this.API_URL}/forgot-password`,{email:e}).pipe(s(this.handleError))}resetPassword(e,r){return this.http.post(`${this.API_URL}/reset-password`,{token:e,newPassword:r}).pipe(s(this.handleError))}resetPasswordWithOtp(e,r,o){return this.http.post(`${this.API_URL}/reset-password-otp`,{email:e,otpCode:r,newPassword:o}).pipe(s(this.handleError))}verifyOtp(e,r){return this.http.get(`${this.API_URL}/verify-otp`,{params:{email:e,otpCode:r}}).pipe(s(this.handleError))}handleAuthentication(e){this.storage.setItem(this.TOKEN_KEY,e.token),this.storage.setItemStringified(this.USER_KEY,e.user),this.tokenSignal.set(e.token),this.currentUserSignal.set(e.user)}loadUserFromStorage(){return this.storage.getItemParsed(this.USER_KEY)}loadTokenFromStorage(){return this.storage.getItem(this.TOKEN_KEY)}handleError(e){let r="Une erreur est survenue";return e.error instanceof ErrorEvent?r=`Erreur: ${e.error.message}`:e.status===400||e.status===401?r=e.error?.message||"Email ou mot de passe incorrect":e.status===409?r=e.error?.message||"L'email est d\xE9j\xE0 utilis\xE9":e.status===0&&(r="Impossible de contacter le serveur"),d(()=>({message:r}))}static \u0275fac=function(r){return new(r||t)};static \u0275prov=i({token:t,factory:t.\u0275fac,providedIn:"root"})};export{l as a,b};
