<header class="sticky top-0 z-40 bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 shadow-sm">
  <div class="flex items-center justify-between px-4 h-16 gap-2">
    <!-- Menu Toggle -->
    <button (click)="onToggleMenu()"
      class="btn-icon text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer disabled:cursor-not-allowed"
      aria-label="Toggle menu" title="Menu">
      <i class="fas fa-bars text-xl"></i>
    </button>

    <!-- App Title & Logo -->
    <div class="flex items-center space-x-3 cursor-pointer" [routerLink]="['/dashboard']">
      <i class="fas fa-briefcase text-2xl text-primary-600 dark:text-primary-400"></i>
      <span class="text-xl font-bold text-gray-900 dark:text-white hidden md:block">{{ appTitle() }}</span>
    </div>

    <div class="flex-1"></div>

    <!-- Actions -->
    <div class="flex items-center space-x-2">
      <!-- Theme Toggle Switch -->
      <button (click)="toggleTheme()"
        class="theme-switch relative flex items-center space-x-2 px-3 py-2 rounded-lg transition-all duration-300 cursor-pointer disabled:cursor-not-allowed"
        aria-label="Changer le thème" title="Changer le thème">
        <!-- Sun Icon -->
        <div class="relative w-5 h-5 transition-all duration-300" [class.opacity-100]="effectiveTheme() === 'light'"
          [class.opacity-0]="effectiveTheme() === 'dark'" [class.scale-100]="effectiveTheme() === 'light'"
          [class.scale-0]="effectiveTheme() === 'dark'">
          <i
            class="fas fa-sun text-amber-500 dark:text-amber-400 absolute inset-0 flex items-center justify-center"></i>
        </div>

        <!-- Toggle Track -->
        <div class="relative w-11 h-6 bg-gray-300 dark:bg-gray-600 rounded-full transition-colors duration-300">
          <!-- Toggle Thumb -->
          <div
            class="absolute top-0.5 left-0.5 w-5 h-5 bg-white dark:bg-gray-800 rounded-full shadow-md transition-all duration-300 flex items-center justify-center"
            [class.translate-x-5]="effectiveTheme() === 'dark'" [class.translate-x-0]="effectiveTheme() === 'light'">
            <div
              class="w-3 h-3 rounded-full bg-gradient-to-br from-amber-400 to-orange-500 dark:from-indigo-400 dark:to-purple-500 transition-all duration-300">
            </div>
          </div>
        </div>

        <!-- Moon Icon -->
        <div class="relative w-5 h-5 transition-all duration-300" [class.opacity-100]="effectiveTheme() === 'dark'"
          [class.opacity-0]="effectiveTheme() === 'light'" [class.scale-100]="effectiveTheme() === 'dark'"
          [class.scale-0]="effectiveTheme() === 'light'">
          <i
            class="fas fa-moon text-indigo-500 dark:text-indigo-400 absolute inset-0 flex items-center justify-center"></i>
        </div>
      </button>

      <!-- Notifications -->
      <div class="relative">
        <button class="btn-icon text-gray-600 dark:text-gray-300 cursor-pointer disabled:cursor-not-allowed" (click)="onNotifications()" aria-label="Notifications"
          title="Notifications">
          <i class="fas fa-bell text-xl"></i>
          @if (notificationCount() > 0) {
          <span
            class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center">{{
            notificationCount() }}</span>
          }
        </button>
      </div>

      <!-- User Menu -->
      <div class="relative">
        <button (click)="showUserMenu.set(!showUserMenu())"
          class="user-menu-trigger flex items-center space-x-2 px-3 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-all duration-200 hover:shadow-sm cursor-pointer disabled:cursor-not-allowed"
          [class.active]="showUserMenu()" aria-label="User menu" aria-expanded="{{showUserMenu()}}">
          <div
            class="w-8 h-8 rounded-full bg-gradient-to-br from-primary-500 to-primary-700 text-white flex items-center justify-center font-semibold shadow-sm ring-2 ring-white dark:ring-gray-800 transition-transform duration-200 hover:scale-105">
            {{ getInitials() }}
          </div>
          @if (currentUser()) {
          <span class="hidden md:block text-sm font-medium text-gray-700 dark:text-gray-300">{{ currentUser()!.prenom
            }}</span>
          }
          <i class="fas fa-chevron-down text-xs text-gray-500 transition-transform duration-200"
            [class.rotate-180]="showUserMenu()"></i>
        </button>

        <!-- Backdrop -->
        @if (showUserMenu()) {
        <div class="fixed inset-0 z-40" (click)="showUserMenu.set(false)" (keyup.enter)="showUserMenu.set(false)" (keydown.space)="showUserMenu.set(false)" tabindex="0" role="button" aria-label="Fermer le menu utilisateur" style="background: transparent;"></div>
        }

        <!-- Dropdown Menu -->
        @if (showUserMenu()) {
        <div
          class="user-dropdown absolute right-0 mt-2 w-72 bg-white dark:bg-gray-800 rounded-xl shadow-xl border border-gray-200 dark:border-gray-700 z-50 overflow-hidden">
          @if (currentUser()) {
          <div
            class="px-4 py-4 bg-gradient-to-br from-gray-50 to-white dark:from-gray-800 dark:to-gray-800 border-b border-gray-200 dark:border-gray-700">
            <div class="flex items-center space-x-3">
              <div class="relative">
                <div
                  class="w-14 h-14 rounded-full bg-gradient-to-br from-primary-500 to-primary-700 text-white flex items-center justify-center font-bold text-xl shadow-md">
                  {{ getInitials() }}
                </div>
                <div
                  class="absolute -bottom-1 -right-1 w-5 h-5 bg-green-500 border-2 border-white dark:border-gray-800 rounded-full">
                </div>
              </div>
              <div class="flex-1 min-w-0">
                <div class="font-semibold text-gray-900 dark:text-white truncate">{{ currentUser()!.prenom }} {{
                  currentUser()!.nom }}</div>
                <div class="text-sm text-gray-500 dark:text-gray-400 truncate">{{ currentUser()!.email }}</div>
                <div
                  class="inline-flex items-center mt-1.5 px-2 py-0.5 bg-primary-100 dark:bg-primary-900/30 text-primary-700 dark:text-primary-300 text-xs font-medium rounded-full">
                  <i class="fas fa-shield-alt mr-1 text-xs"></i>
                  {{ currentUser()!.role }}
                </div>
              </div>
            </div>
          </div>
          }

          <div class="py-1">
            <button [routerLink]="['/profile']" (click)="showUserMenu.set(false)"
              class="menu-item w-full flex items-center px-4 py-3 text-sm text-gray-700 dark:text-gray-300 hover:bg-primary-50 dark:hover:bg-primary-900/20 transition-all duration-150 group cursor-pointer disabled:cursor-not-allowed">
              <div
                class="w-9 h-9 rounded-lg bg-gray-100 dark:bg-gray-700 flex items-center justify-center mr-3 group-hover:bg-primary-100 dark:group-hover:bg-primary-900/40 transition-colors duration-150">
                <i
                  class="fas fa-user text-gray-600 dark:text-gray-400 group-hover:text-primary-600 dark:group-hover:text-primary-400"></i>
              </div>
              <span class="flex-1 text-left font-medium">Mon profil</span>
              <i
                class="fas fa-chevron-right text-xs text-gray-400 opacity-0 group-hover:opacity-100 transition-opacity duration-150"></i>
            </button>

            <button [routerLink]="['/settings']" (click)="showUserMenu.set(false)"
              class="menu-item w-full flex items-center px-4 py-3 text-sm text-gray-700 dark:text-gray-300 hover:bg-primary-50 dark:hover:bg-primary-900/20 transition-all duration-150 group cursor-pointer disabled:cursor-not-allowed">
              <div
                class="w-9 h-9 rounded-lg bg-gray-100 dark:bg-gray-700 flex items-center justify-center mr-3 group-hover:bg-primary-100 dark:group-hover:bg-primary-900/40 transition-colors duration-150">
                <i
                  class="fas fa-cog text-gray-600 dark:text-gray-400 group-hover:text-primary-600 dark:group-hover:text-primary-400"></i>
              </div>
              <span class="flex-1 text-left font-medium">Paramètres</span>
              <i
                class="fas fa-chevron-right text-xs text-gray-400 opacity-0 group-hover:opacity-100 transition-opacity duration-150"></i>
            </button>
          </div>

          <div class="border-t border-gray-200 dark:border-gray-700"></div>

          <div class="py-1">
            <button (click)="onLogout(); showUserMenu.set(false)"
              class="menu-item w-full flex items-center px-4 py-3 text-sm text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 transition-all duration-150 group cursor-pointer disabled:cursor-not-allowed">
              <div
                class="w-9 h-9 rounded-lg bg-red-50 dark:bg-red-900/20 flex items-center justify-center mr-3 group-hover:bg-red-100 dark:group-hover:bg-red-900/40 transition-colors duration-150">
                <i class="fas fa-sign-out-alt text-red-600 dark:text-red-400"></i>
              </div>
              <span class="flex-1 text-left font-medium">Déconnexion</span>
              <i
                class="fas fa-arrow-right text-xs opacity-0 group-hover:opacity-100 transition-opacity duration-150"></i>
            </button>
          </div>
        </div>
        }
      </div>
    </div>
  </div>
</header>