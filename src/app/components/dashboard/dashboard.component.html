<div class="max-w-7xl mx-auto p-6">
  <!-- Header avec message de bienvenue -->
  <div class="mb-8">
    <h1 class="text-3xl font-bold text-gray-900 dark:text-white flex items-center gap-3 mb-2">
      <i class="fas fa-home text-primary-600 dark:text-primary-400"></i>
      Tableau de bord
    </h1>
    <p class="text-gray-600 dark:text-gray-400">Bienvenue ! Voici un aperçu de votre activité</p>
  </div>

  @if (isLoading()) {
    <app-loading-spinner message="Chargement..." [fullscreen]="true" />
  } @else if (errorMessage()) {
    <app-error-card 
      title="Erreur de chargement"
      [message]="errorMessage()!" 
      (retry)="loadData()" 
    />
  } @else {
    <!-- Actions rapides -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
      <button class="card hover:shadow-lg transition-all group cursor-pointer border-2 border-primary-200 dark:border-primary-800 hover:border-primary-400 dark:hover:border-primary-600" routerLink="/candidatures/new">
        <div class="flex items-center gap-4">
          <div class="p-4 rounded-lg bg-primary-100 dark:bg-primary-900/30 group-hover:bg-primary-200 dark:group-hover:bg-primary-800/50 transition-colors">
            <i class="fas fa-plus text-3xl text-primary-600 dark:text-primary-400"></i>
          </div>
          <div class="text-left">
            <h3 class="font-semibold text-lg text-gray-900 dark:text-white">Nouvelle candidature</h3>
            <p class="text-sm text-gray-600 dark:text-gray-400">Ajouter une candidature</p>
          </div>
        </div>
      </button>

      <button class="card hover:shadow-lg transition-all group cursor-pointer border-2 border-purple-200 dark:border-purple-800 hover:border-purple-400 dark:hover:border-purple-600" routerLink="/candidatures">
        <div class="flex items-center gap-4">
          <div class="p-4 rounded-lg bg-purple-100 dark:bg-purple-900/30 group-hover:bg-purple-200 dark:group-hover:bg-purple-800/50 transition-colors">
            <i class="fas fa-list text-3xl text-purple-600 dark:text-purple-400"></i>
          </div>
          <div class="text-left">
            <h3 class="font-semibold text-lg text-gray-900 dark:text-white">Mes candidatures</h3>
            <p class="text-sm text-gray-600 dark:text-gray-400">Voir toutes mes candidatures</p>
          </div>
        </div>
      </button>

      <button class="card hover:shadow-lg transition-all group cursor-pointer border-2 border-blue-200 dark:border-blue-800 hover:border-blue-400 dark:hover:border-blue-600" routerLink="/stats">
        <div class="flex items-center gap-4">
          <div class="p-4 rounded-lg bg-blue-100 dark:bg-blue-900/30 group-hover:bg-blue-200 dark:group-hover:bg-blue-800/50 transition-colors">
            <i class="fas fa-chart-bar text-3xl text-blue-600 dark:text-blue-400"></i>
          </div>
          <div class="text-left">
            <h3 class="font-semibold text-lg text-gray-900 dark:text-white">Statistiques</h3>
            <p class="text-sm text-gray-600 dark:text-gray-400">Analyses détaillées</p>
          </div>
        </div>
      </button>
    </div>

    <!-- Statistiques principales -->
    @if (stats()) {
      <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
        <div class="card bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-800/20 border-blue-200 dark:border-blue-700 hover:shadow-lg transition-all">
          <div class="text-center">
            <div class="text-3xl font-bold text-blue-600 dark:text-blue-400 mb-1">{{ stats()!.totalCandidatures }}</div>
            <div class="text-sm text-blue-700 dark:text-blue-300 font-medium">Total</div>
          </div>
        </div>
        <div class="card bg-gradient-to-br from-yellow-50 to-yellow-100 dark:from-yellow-900/20 dark:to-yellow-800/20 border-yellow-200 dark:border-yellow-700 hover:shadow-lg transition-all">
          <div class="text-center">
            <div class="text-3xl font-bold text-yellow-600 dark:text-yellow-400 mb-1">{{ stats()!.enCours }}</div>
            <div class="text-sm text-yellow-700 dark:text-yellow-300 font-medium">En cours</div>
          </div>
        </div>
        <div class="card bg-gradient-to-br from-green-50 to-green-100 dark:from-green-900/20 dark:to-green-800/20 border-green-200 dark:border-green-700 hover:shadow-lg transition-all">
          <div class="text-center">
            <div class="text-3xl font-bold text-green-600 dark:text-green-400 mb-1">{{ stats()!.acceptees }}</div>
            <div class="text-sm text-green-700 dark:text-green-300 font-medium">Acceptées</div>
          </div>
        </div>
        <div class="card bg-gradient-to-br from-purple-50 to-purple-100 dark:from-purple-900/20 dark:to-purple-800/20 border-purple-200 dark:border-purple-700 hover:shadow-lg transition-all">
          <div class="text-center">
            <div class="text-3xl font-bold text-purple-600 dark:text-purple-400 mb-1">{{ stats()!.entretiens }}</div>
            <div class="text-sm text-purple-700 dark:text-purple-300 font-medium">Entretiens</div>
          </div>
        </div>
      </div>

      <!-- Statistiques avancées -->
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
        <!-- Score moyen -->
        <div class="card bg-gradient-to-br from-amber-50 to-orange-100 dark:from-amber-900/20 dark:to-orange-800/20 border-amber-200 dark:border-amber-700">
          <div class="flex items-center justify-between mb-4">
            <h3 class="text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2">
              <i class="fas fa-star text-amber-600 dark:text-amber-400"></i>
              Score moyen
            </h3>
          </div>
          <div class="text-center">
            <div class="text-4xl font-bold text-amber-600 dark:text-amber-400 mb-2">
              {{ scoreStats().average }}/5
            </div>
            <div class="flex justify-center gap-1 mb-2">
              @for (star of [1,2,3,4,5]; track star) {
                <i class="fas fa-star text-xl"
                  [class.text-amber-400]="star <= scoreStats().average"
                  [class.dark:text-amber-500]="star <= scoreStats().average"
                  [class.text-gray-300]="star > scoreStats().average"
                  [class.dark:text-gray-600]="star > scoreStats().average"></i>
              }
            </div>
            <p class="text-sm text-amber-700 dark:text-amber-300">
              {{ scoreStats().count }} candidature(s) notée(s)
            </p>
          </div>
        </div>

        <!-- Répartition par type de contrat -->
        <div class="card">
          <div class="flex items-center justify-between mb-4">
            <h3 class="text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2">
              <i class="fas fa-file-contract text-primary-600 dark:text-primary-400"></i>
              Types de contrat
            </h3>
          </div>
          <div class="space-y-3">
            @for (stat of typeContratStats(); track stat.type) {
              <div class="flex items-center justify-between">
                <span class="text-sm font-medium text-gray-700 dark:text-gray-300">{{ stat.type }}</span>
                <div class="flex items-center gap-2">
                  <div class="w-24 h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden">
                    <div class="h-full rounded-full transition-all duration-300"
                      [class.bg-blue-500]="getTypeContratColor(stat.type) === 'blue'"
                      [class.bg-purple-500]="getTypeContratColor(stat.type) === 'purple'"
                      [class.bg-green-500]="getTypeContratColor(stat.type) === 'green'"
                      [class.bg-yellow-500]="getTypeContratColor(stat.type) === 'yellow'"
                      [class.bg-indigo-500]="getTypeContratColor(stat.type) === 'indigo'"
                      [class.bg-pink-500]="getTypeContratColor(stat.type) === 'pink'"
                      [style.width.%]="stat.percentage"></div>
                  </div>
                  <span class="text-sm font-semibold text-gray-900 dark:text-white w-12 text-right">
                    {{ stat.count }}
                  </span>
                </div>
              </div>
            }
            @if (typeContratStats().length === 0) {
              <p class="text-sm text-gray-500 dark:text-gray-400 text-center py-4">
                Aucune donnée disponible
              </p>
            }
          </div>
        </div>

        <!-- Répartition par priorité -->
        <div class="card">
          <div class="flex items-center justify-between mb-4">
            <h3 class="text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2">
              <i class="fas fa-exclamation-triangle text-primary-600 dark:text-primary-400"></i>
              Priorités
            </h3>
          </div>
          <div class="space-y-3">
            @for (stat of prioriteStats(); track stat.priorite) {
              <div class="flex items-center justify-between">
                <span class="text-sm font-medium text-gray-700 dark:text-gray-300">{{ stat.priorite }}</span>
                <div class="flex items-center gap-2">
                  <div class="w-24 h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden">
                    <div class="h-full rounded-full transition-all duration-300"
                      [class.bg-red-500]="getPrioriteColor(stat.priorite) === 'red'"
                      [class.bg-yellow-500]="getPrioriteColor(stat.priorite) === 'yellow'"
                      [class.bg-green-500]="getPrioriteColor(stat.priorite) === 'green'"
                      [style.width.%]="stat.percentage"></div>
                  </div>
                  <span class="text-sm font-semibold text-gray-900 dark:text-white w-12 text-right">
                    {{ stat.count }}
                  </span>
                </div>
              </div>
            }
            @if (prioriteStats().length === 0) {
              <p class="text-sm text-gray-500 dark:text-gray-400 text-center py-4">
                Aucune donnée disponible
              </p>
            }
          </div>
        </div>
      </div>
    }

    <!-- Top candidatures et actions -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
      <!-- Top candidatures par score -->
      @if (topCandidatures().length > 0) {
        <div class="card">
          <div class="flex items-center justify-between mb-4">
            <h2 class="text-xl font-semibold text-gray-900 dark:text-white flex items-center gap-2">
              <i class="fas fa-trophy text-amber-600 dark:text-amber-400"></i>
              Top candidatures
            </h2>
          </div>
          <div class="space-y-3">
            @for (candidature of topCandidatures(); track candidature.id) {
              <div class="p-3 rounded-lg bg-gray-50 dark:bg-gray-800 hover:bg-amber-50 dark:hover:bg-amber-900/20 transition-colors cursor-pointer border border-transparent hover:border-amber-200 dark:hover:border-amber-800" 
                [routerLink]="['/candidatures', candidature.id]">
                <div class="flex items-center justify-between">
                  <div class="flex-1">
                    <h3 class="font-semibold text-gray-900 dark:text-white mb-1">{{ candidature.poste }}</h3>
                    <p class="text-sm text-gray-600 dark:text-gray-400">{{ candidature.entreprise }}</p>
                  </div>
                  <div class="flex items-center gap-2">
                    <div class="flex items-center gap-1">
                      @for (star of [1,2,3,4,5]; track star) {
                        <i class="fas fa-star text-sm"
                          [class.text-amber-400]="star <= (candidature.score || 0)"
                          [class.text-gray-300]="star > (candidature.score || 0)"></i>
                      }
                    </div>
                  </div>
                </div>
              </div>
            }
          </div>
        </div>
      }

      <!-- Candidatures prioritaires -->
      @if (prioriteCandidatures().length > 0) {
        <div class="card">
          <div class="flex items-center justify-between mb-4">
            <h2 class="text-xl font-semibold text-gray-900 dark:text-white flex items-center gap-2">
              <i class="fas fa-flag text-red-600 dark:text-red-400"></i>
              Priorité haute
            </h2>
          </div>
          <div class="space-y-3">
            @for (candidature of prioriteCandidatures(); track candidature.id) {
              <div class="p-3 rounded-lg bg-gray-50 dark:bg-gray-800 hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors cursor-pointer border border-transparent hover:border-red-200 dark:hover:border-red-800" 
                [routerLink]="['/candidatures', candidature.id]">
                <div class="flex items-center justify-between">
                  <div class="flex-1">
                    <h3 class="font-semibold text-gray-900 dark:text-white mb-1">{{ candidature.poste }}</h3>
                    <div class="flex items-center gap-3 text-sm text-gray-600 dark:text-gray-400">
                      <span class="flex items-center gap-1">
                        <i class="fas fa-building text-xs"></i>
                        {{ candidature.entreprise }}
                      </span>
                      <span class="flex items-center gap-1">
                        <i class="fas fa-calendar text-xs"></i>
                        {{ formatDate(candidature.dateCandidature) }}
                      </span>
                    </div>
                  </div>
                  <app-status-badge [statut]="candidature.statut" />
                </div>
              </div>
            }
          </div>
        </div>
      }
    </div>

    <!-- Relances à prévoir -->
    @if (relancesCandidatures().length > 0) {
      <div class="card mb-8">
        <div class="flex items-center justify-between mb-4">
          <h2 class="text-xl font-semibold text-gray-900 dark:text-white flex items-center gap-2">
            <i class="fas fa-bell text-orange-600 dark:text-orange-400"></i>
            Relances à prévoir
          </h2>
        </div>
        <div class="space-y-3">
          @for (candidature of relancesCandidatures(); track candidature.id) {
            <div class="p-3 rounded-lg bg-gray-50 dark:bg-gray-800 hover:bg-orange-50 dark:hover:bg-orange-900/20 transition-colors cursor-pointer border border-transparent hover:border-orange-200 dark:hover:border-orange-800" 
              [routerLink]="['/candidatures', candidature.id]">
              <div class="flex items-center justify-between">
                <div class="flex-1">
                  <h3 class="font-semibold text-gray-900 dark:text-white mb-1">{{ candidature.poste }}</h3>
                  <div class="flex items-center gap-3 text-sm text-gray-600 dark:text-gray-400">
                    <span class="flex items-center gap-1">
                      <i class="fas fa-building text-xs"></i>
                      {{ candidature.entreprise }}
                    </span>
                    <span class="flex items-center gap-1 text-orange-600 dark:text-orange-400 font-medium">
                      <i class="fas fa-clock text-xs"></i>
                      {{ formatDate(candidature.dateRelancePrevue!) }}
                    </span>
                  </div>
                </div>
                <app-status-badge [statut]="candidature.statut" />
              </div>
            </div>
          }
        </div>
      </div>
    }

    <!-- Candidatures récentes -->
    @if (recentCandidatures() && recentCandidatures()!.length > 0) {
      <div class="card">
        <div class="flex items-center justify-between mb-6">
          <h2 class="text-xl font-semibold text-gray-900 dark:text-white flex items-center gap-2">
            <i class="fas fa-history text-primary-600 dark:text-primary-400"></i>
            Candidatures récentes
          </h2>
          <a routerLink="/candidatures" class="text-primary-600 dark:text-primary-400 hover:text-primary-700 dark:hover:text-primary-300 text-sm font-medium">
            Voir tout
            <i class="fas fa-arrow-right ml-1"></i>
          </a>
        </div>
        <div class="space-y-3">
          @for (candidature of recentCandidatures(); track candidature.id) {
            <div class="p-4 rounded-lg bg-gray-50 dark:bg-gray-800 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors cursor-pointer" [routerLink]="['/candidatures', candidature.id]">
              <div class="flex items-center justify-between">
                <div class="flex-1">
                  <h3 class="font-semibold text-gray-900 dark:text-white mb-1">{{ candidature.poste }}</h3>
                  <div class="flex items-center gap-4 text-sm text-gray-600 dark:text-gray-400">
                    <span class="flex items-center gap-1">
                      <i class="fas fa-building text-xs"></i>
                      {{ candidature.entreprise }}
                    </span>
                    <span class="flex items-center gap-1">
                      <i class="fas fa-map-marker-alt text-xs"></i>
                      {{ candidature.localisation }}
                    </span>
                    <span class="flex items-center gap-1">
                      <i class="fas fa-calendar text-xs"></i>
                      {{ formatDate(candidature.dateCandidature) }}
                    </span>
                  </div>
                </div>
                <app-status-badge [statut]="candidature.statut" />
              </div>
            </div>
          }
        </div>
      </div>
    } @else if (stats() && stats()!.totalCandidatures === 0) {
      <div class="card text-center py-12">
        <i class="fas fa-briefcase text-6xl text-gray-300 dark:text-gray-600 mb-4"></i>
        <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-2">Aucune candidature</h3>
        <p class="text-gray-600 dark:text-gray-400 mb-6">Commencez à suivre vos candidatures dès maintenant</p>
        <button class="btn-primary cursor-pointer disabled:cursor-not-allowed" routerLink="/candidatures/new">
          <i class="fas fa-plus"></i>
          Créer ma première candidature
        </button>
      </div>
    }
  }
</div>
