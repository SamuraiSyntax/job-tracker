import{b as D,c as G}from"./chunk-D5Z3OYPT.js";import"./chunk-KQ5OUKJ7.js";import{b as M,c as m,d as L,e as N,g as T,i as V,j as k,q as O,r as A,t as j}from"./chunk-VSJU3HT3.js";import{b as E}from"./chunk-JF3B47YD.js";import{$ as u,Ga as b,M as i,P as c,Q as h,Ta as S,Za as P,_ as p,da as d,db as y,ea as a,fa as s,fb as x,ga as l,gb as F,jb as _,lb as R,ma as v,oa as g,va as w,xa as n,ya as C}from"./chunk-6FHC7S6G.js";var q=(o,t)=>({"text-green-600":o,"text-red-600":t});function z(o,t){o&1&&(a(0,"span"),n(1,"V\xE9rifier"),s())}function B(o,t){o&1&&l(0,"span",11)}function W(o,t){if(o&1&&(a(0,"div",12),n(1),s()),o&2){let r=g();d("ngClass",b(2,q,r.otpStatus==="valid",r.otpStatus==="invalid"||r.otpStatus==="expired")),i(),C(r.otpMessage)}}function $(o,t){o&1&&(a(0,"div",18),n(1," Les mots de passe ne correspondent pas "),s())}function H(o,t){o&1&&(a(0,"span"),n(1,"R\xE9initialiser le mot de passe"),s())}function J(o,t){o&1&&l(0,"span",11)}var I=class o{constructor(t,r,e,f,K){this.fb=t;this.route=r;this.authService=e;this.notification=f;this.router=K;this.email=this.route.snapshot.queryParamMap.get("email")||"",this.resetForm=this.fb.group({email:[this.email,[m.required,m.email]],otpCode:["",[m.required,m.pattern("^[0-9]{6}$")]],newPassword:[{value:"",disabled:!0},[m.required,m.minLength(8)]],confirmPassword:[{value:"",disabled:!0},[m.required]]},{validators:this.passwordsMatchValidator})}resetForm;isLoading=!1;submitted=!1;email="";otpStatus="pending";otpMessage="";updatePasswordFieldsState(){this.otpStatus==="valid"?(this.newPassword?.enable(),this.confirmPassword?.enable()):(this.newPassword?.disable(),this.confirmPassword?.disable())}get emailControl(){return this.resetForm.get("email")}get otpCode(){return this.resetForm.get("otpCode")}get newPassword(){return this.resetForm.get("newPassword")}get confirmPassword(){return this.resetForm.get("confirmPassword")}passwordsMatchValidator(t){let r=t.get("newPassword")?.value,e=t.get("confirmPassword")?.value;return r===e?null:{passwordMismatch:!0}}onVerifyOtp(){let{email:t,otpCode:r}=this.resetForm.value;if(!t||!r||this.otpCode?.invalid){this.otpStatus="invalid",this.otpMessage="Veuillez saisir un code valide.";return}this.isLoading=!0,this.authService.verifyOtp(t,r).subscribe({next:e=>{e.valid?(this.otpStatus="valid",this.otpMessage="Code OTP valide.",this.updatePasswordFieldsState()):e.expired?(this.otpStatus="expired",this.otpMessage="Code OTP expir\xE9.",this.updatePasswordFieldsState()):(this.otpStatus="invalid",this.otpMessage=e.message||"Code OTP invalide.",this.updatePasswordFieldsState()),this.isLoading=!1},error:e=>{this.otpStatus="invalid",this.otpMessage=e?.message||"Erreur lors de la v\xE9rification.",this.updatePasswordFieldsState(),this.isLoading=!1}})}onSubmit(){if(this.submitted=!0,this.resetForm.invalid||this.otpStatus!=="valid"){this.notification.error(this.otpStatus==="valid"?"Formulaire invalide.":this.otpMessage||"Veuillez v\xE9rifier le code OTP.");return}this.isLoading=!0;let{email:t,otpCode:r,newPassword:e}=this.resetForm.value;this.authService.resetPasswordWithOtp(t,r,e).subscribe({next:()=>{this.notification.success("Votre mot de passe a \xE9t\xE9 r\xE9initialis\xE9 avec succ\xE8s."),this.isLoading=!1,this.router.navigate(["/auth/login"])},error:f=>{this.notification.error(f?.message||"Erreur lors de la r\xE9initialisation."),this.isLoading=!1}})}static \u0275fac=function(r){return new(r||o)(c(A),c(y),c(E),c(R),c(x))};static \u0275cmp=h({type:o,selectors:[["app-reset-password"]],decls:36,vars:17,consts:[["title","R\xE9initialisation du mot de passe","subtitle","Saisissez le code re\xE7u par email"],[1,"space-y-6",3,"ngSubmit","formGroup"],[1,"border-b","pb-4","mb-4"],[1,"mb-2","text-base","font-semibold","text-primary-700"],["for","email",1,"block","text-sm","font-medium","mb-2"],["id","email","type","email","formControlName","email",1,"w-full","px-4","py-2","border","rounded-lg",3,"readonly"],[3,"control"],["for","otpCode",1,"block","text-sm","font-medium","mt-4","mb-2"],[1,"flex","gap-2"],["id","otpCode","type","text","maxlength","6","formControlName","otpCode",1,"w-full","px-4","py-2","border","rounded-lg",3,"readonly"],["type","button",1,"px-4","py-2","bg-primary-500","text-white","rounded-lg","flex","items-center","justify-center","cursor-pointer","disabled:cursor-not-allowed",3,"click","disabled"],[1,"loader","ml-2"],[1,"text-sm","mt-1","font-semibold",3,"ngClass"],[1,"opacity-100","transition-opacity","duration-300"],["for","newPassword",1,"block","text-sm","font-medium","mb-2"],["id","newPassword","type","password","formControlName","newPassword",1,"w-full","px-4","py-2","border","rounded-lg"],["for","confirmPassword",1,"block","text-sm","font-medium","mb-2","mt-4"],["id","confirmPassword","type","password","formControlName","confirmPassword",1,"w-full","px-4","py-2","border","rounded-lg"],[1,"text-sm","text-red-600"],["type","submit",1,"w-full","py-2","bg-primary-600","text-white","rounded-lg","flex","items-center","justify-center","mt-4","cursor-pointer","disabled:cursor-not-allowed",3,"disabled"],[1,"text-center","mt-4"],["routerLink","/auth/login",1,"text-sm","text-indigo-600","hover:underline"]],template:function(r,e){r&1&&(a(0,"app-auth-card",0)(1,"form",1),v("ngSubmit",function(){return e.onSubmit()}),a(2,"div",2)(3,"div",3),n(4,"1. V\xE9rifiez le code OTP"),s(),a(5,"label",4),n(6,"Email"),s(),l(7,"input",5)(8,"app-form-field-error",6),a(9,"label",7),n(10,"Code re\xE7u par email"),s(),a(11,"div",8),l(12,"input",9),a(13,"button",10),v("click",function(){return e.onVerifyOtp()}),p(14,z,2,0,"span"),p(15,B,1,0,"span",11),s()(),l(16,"app-form-field-error",6),p(17,W,2,5,"div",12),s(),a(18,"div",13)(19,"div",3),n(20,"2. Saisissez le nouveau mot de passe"),s(),a(21,"label",14),n(22,"Nouveau mot de passe"),s(),l(23,"input",15)(24,"app-form-field-error",6),a(25,"label",16),n(26,"Confirmer le mot de passe"),s(),l(27,"input",17)(28,"app-form-field-error",6),p(29,$,2,0,"div",18),s(),a(30,"button",19),p(31,H,2,0,"span"),p(32,J,1,0,"span",11),s()(),a(33,"div",20)(34,"a",21),n(35,"Retour \xE0 la connexion"),s()()()),r&2&&(i(),d("formGroup",e.resetForm),i(6),d("readonly",!0),i(),d("control",e.emailControl),i(4),d("readonly",e.otpStatus==="valid"),i(),d("disabled",(e.otpCode==null?null:e.otpCode.invalid)||e.isLoading||e.otpStatus==="valid"),i(),u(e.isLoading?-1:14),i(),u(e.isLoading?15:-1),i(),d("control",e.otpCode),i(),u(e.otpStatus!=="pending"?17:-1),i(),w("opacity-50",e.otpStatus!=="valid"),i(6),d("control",e.newPassword),i(4),d("control",e.confirmPassword),i(),u(e.resetForm.hasError("passwordMismatch")&&(e.confirmPassword!=null&&e.confirmPassword.touched)?29:-1),i(),d("disabled",e.resetForm.invalid||e.isLoading||e.otpStatus!=="valid"),i(),u(e.isLoading?-1:31),i(),u(e.isLoading?32:-1))},dependencies:[P,S,j,T,M,L,N,O,k,V,G,D,_,F],encapsulation:2,changeDetection:0})};export{I as ResetPasswordComponent};
