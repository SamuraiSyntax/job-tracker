import{j as h,o as m,t as d}from"./chunk-S6MISZWQ.js";import{H as i,L as o,Q as s,Qb as c,ga as u,m as g,y as l}from"./chunk-G3X2Z5OP.js";var a=class t{getItem(e){try{return localStorage.getItem(e)}catch(r){return console.error(`Erreur lors de la lecture de localStorage[${e}]:`,r),null}}getItemParsed(e){try{let r=localStorage.getItem(e);return r?JSON.parse(r):null}catch(r){return console.error(`Erreur lors du parsing de localStorage[${e}]:`,r),null}}setItem(e,r){try{return localStorage.setItem(e,r),!0}catch(n){return console.error(`Erreur lors de l'\xE9criture dans localStorage[${e}]:`,n),!1}}setItemStringified(e,r){try{return localStorage.setItem(e,JSON.stringify(r)),!0}catch(n){return console.error(`Erreur lors de la s\xE9rialisation dans localStorage[${e}]:`,n),!1}}removeItem(e){try{return localStorage.removeItem(e),!0}catch(r){return console.error(`Erreur lors de la suppression de localStorage[${e}]:`,r),!1}}clear(){try{return localStorage.clear(),!0}catch(e){return console.error("Erreur lors du nettoyage de localStorage:",e),!1}}hasItem(e){try{return localStorage.getItem(e)!==null}catch(r){return console.error(`Erreur lors de la v\xE9rification de localStorage[${e}]:`,r),!1}}keys(){try{return Object.keys(localStorage)}catch(e){return console.error("Erreur lors de la r\xE9cup\xE9ration des cl\xE9s de localStorage:",e),[]}}length(){try{return localStorage.length}catch(e){return console.error("Erreur lors du comptage des \xE9l\xE9ments de localStorage:",e),0}}static \u0275fac=function(r){return new(r||t)};static \u0275prov=o({token:t,factory:t.\u0275fac,providedIn:"root"})};var p=class t{API_URL=`${d.apiUrl}/auth`;TOKEN_KEY="auth_token";USER_KEY="current_user";http=s(h);router=s(m);storage=s(a);currentUserSignal=u(this.loadUserFromStorage());tokenSignal=u(this.loadTokenFromStorage());isAuthenticated=c(()=>!!this.tokenSignal());getCurrentUser=c(()=>this.currentUserSignal());login(e){return this.http.post(`${this.API_URL}/login`,e).pipe(i(r=>this.handleAuthentication(r)),l(this.handleError))}register(e){return this.http.post(`${this.API_URL}/register`,e).pipe(i(r=>this.handleAuthentication(r)),l(this.handleError))}logout(){this.storage.removeItem(this.TOKEN_KEY),this.storage.removeItem(this.USER_KEY),this.tokenSignal.set(null),this.currentUserSignal.set(null),this.router.navigate(["/auth/login"])}getToken(){return this.tokenSignal()}handleAuthentication(e){this.storage.setItem(this.TOKEN_KEY,e.token),this.storage.setItemStringified(this.USER_KEY,e.user),this.tokenSignal.set(e.token),this.currentUserSignal.set(e.user)}loadUserFromStorage(){return this.storage.getItemParsed(this.USER_KEY)}loadTokenFromStorage(){return this.storage.getItem(this.TOKEN_KEY)}handleError(e){let r="Une erreur est survenue";return e.error instanceof ErrorEvent?r=`Erreur: ${e.error.message}`:e.status===400||e.status===401?r=e.error?.message||"Email ou mot de passe incorrect":e.status===409?r=e.error?.message||"L'email est d\xE9j\xE0 utilis\xE9":e.status===0&&(r="Impossible de contacter le serveur"),g(()=>({message:r}))}static \u0275fac=function(r){return new(r||t)};static \u0275prov=o({token:t,factory:t.\u0275fac,providedIn:"root"})};export{p as a};
